{% extends "ds/modal.html" %}
{% block modal_body %}
<style>
    /* CSS untuk membuat checkbox lebih menarik */
    input[type="checkbox"].hidden + span {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* Menampilkan checkbox ketika checkbox dipilih */
    input[type="checkbox"]:checked + span {
        background-color: #4CAF50; /* Ganti dengan warna pilihan Anda */
        color: white; /* Warna teks yang terlihat di checkbox */
    }

    /* Mengganti warna border checkbox */
    span {
        border-color: #ccc;
    }

    /* Ketika checkbox dipilih */
    input[type="checkbox"]:checked + span {
        border-color: #4CAF50; /* Ganti dengan warna pilihan Anda */
    }

    .submit-button {
        background-color: #4CAF50; /* Warna latar belakang hijau */
        color: white; /* Warna teks putih */
        padding: 10px 20px; /* Padding atas/bawah dan kiri/kanan */
        border: none; /* Menghilangkan border default */
        border-radius: 5px; /* Membuat sudut tombol menjadi melengkung */
        cursor: pointer; /* Menampilkan kursor pointer saat hover */
        font-size: 16px; /* Ukuran font */
        transition: background-color 0.3s ease; /* Efek transisi saat hover */
    }

    .submit-button:hover {
        background-color: #45a049; /* Warna latar belakang saat hover */
    }

</style>

<div class="p-4"> <!-- Menambahkan padding di luar form -->
    <h1>{{ event.title }} - Ticket Selection</h1>

    <form method="POST" action="{% url 'yogevent:select_ticket' event.uuid %}" class="mt-4" id="ticket-form"> 
       {% csrf_token %}
       <h2>Select a Ticket</h2>
            <ul id="ticket-options" class="list-disc pl-5" style="list-style-type: none; padding-left: 0;">
                {% for ticket in event.ticketPrice.all %}
                    <li class="mb-2">
                        <label class="flex items-center">
                            <input type="checkbox" name="ticket_ids" value="{{ ticket.id }}" class="hidden" onchange="updateCheckbox(this)">
                            <span class="flex items-center justify-center w-5 h-5 border-2 border-gray-300 rounded-lg mr-2 cursor-pointer transition-colors duration-200 ease-in-out">
                                <span class="hidden">âœ“</span>
                            </span>
                            {{ ticket.name }} - 
                            {% if ticket.isFree %}
                                Free
                            {% else %}
                                Rp {{ ticket.price }}
                            {% endif %}
                        </label>
                    </li>
                {% empty %}
                    <p>No tickets available for this event.</p>
                {% endfor %}
            </ul>
            
            <button type="button" onclick="submitForm()" class="submit-button">Submit Tickets</button>
    </form>
</div>

<script>
    function updateCheckbox(checkbox) {
        const span = checkbox.nextElementSibling;

        if (checkbox.checked) {
            span.querySelector('span').classList.remove('hidden'); // Tampilkan tanda centang
        } else {
            span.querySelector('span').classList.add('hidden'); // Sembunyikan tanda centang
        }
    }

    function submitForm() {
        const form = document.getElementById('ticket-form'); // Ambil form berdasarkan ID
        if (!form) {
            console.error('Form not found!');
            return; // Jika form tidak ditemukan, hentikan eksekusi
        }
        const formData = new FormData(form); // Buat objek FormData dari elemen form

        fetch(form.action, {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',  // Pastikan CSRF token ada
            }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok ' + response.statusText);
            }
            return response.json();
        })
        .then(data => {
            console.log('Success:', data);
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
</script>

{% endblock modal_body %}